name: build

on: 
  push:
  workflow_dispatch:

jobs:

  html5:
      runs-on: ubuntu-latest
      steps:
      -
        name: Checkout
        uses: actions/checkout@v3
      -
        name: Prepare project (Cmake)
        run: cmake . -DCMAKE_MAKE_PROGRAM=make -DCMAKE_C_FLAGS="-DMAX_PLAYERS=1"
      -
        name: Build project (Makefile)
        run: make
      -
        name: Build page (Makefile)
        run: >-
          mkdir -p html &&
          sh -c 'awk "{gsub(/{{game}}/, \"Kokobatoru 2\");} /{{rom}}/ {cmd=\"base64 bin/kokobatoru.nes\"; cmd | getline var; close(cmd); gsub(/{{rom}}/, var);} 1" res/index.html' > html/kokobatoru.html &&
          sh -c 'awk "{gsub(/{{game}}/, \"Coco Battle Royale II\");} /{{rom}}/ {cmd=\"base64 bin/cocobattleroyale.nes\"; cmd | getline var; close(cmd); gsub(/{{rom}}/, var);} 1" res/index.html' > html/cocobattleroyale.html
